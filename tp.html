<!DOCTYPE html>
<!--[if IE 9 ]><html class="ie9"><![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Trabajos Programados | Aquiles</title>

        <!-- Vendor CSS -->
        <link href="vendors/bower_components/animate.css/animate.min.css" rel="stylesheet">
        <link href="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.css" rel="stylesheet">
        <link href="vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css" rel="stylesheet">
        <link href="vendors/bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css" rel="stylesheet">
        <link href="vendors/bootgrid/jquery.bootgrid.min.css" rel="stylesheet">
        <link href="vendors/bower_components/google-material-color/dist/palette.css" rel="stylesheet">

        <link href="vendors/bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" rel="stylesheet">

        <link rel='stylesheet' href='vendors/datatables-bootstrap/dataTables.bootstrap.css'>
        <link rel='stylesheet' href='vendors/datatables2/dataTables.css'>

        <!-- CSS -->
        <link href="css/app.min.1.css" rel="stylesheet">
        <link href="css/app.min.2.css" rel="stylesheet">

        <style>
            .chkGrande
            {
              /* Double-sized Checkboxes */
              -ms-transform: scale(2); /* IE */
              -moz-transform: scale(2); /* FF */
              -webkit-transform: scale(2); /* Safari and Chrome */
              -o-transform: scale(2); /* Opera */
              padding: 10px;
            }
        </style>

        
    </head>
    <body data-ma-header="wsp">
        <header id="header" class="media">
            
        </header>

        <section id="main">
            <aside id="s-main-menu" class="sidebar">
                <div class="smm-header">
                    <i class="zmdi zmdi-long-arrow-left" data-ma-action="sidebar-close"></i>
                </div>

                <ul class="smm-alerts">

                </ul>

                <ul class="main-menu">
                	<br>
                    <li><a href="maniobras.html"><i class="zmdi zmdi-arrow-left"></i> Volver a Maniobras</a></li>
                </ul>
            </aside>

            <section id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title"></h4>
                                </div>
                                <div class="card-body card-padding form-horizontal">
                                    <form id="frmTP_Busqueda">
                                        <div class="col-sm-5">
                                            <div class="form-group">
                                                <label for="txtTP_Filtro" class="col-sm-3 control-label">Desde</label>
                                                <div class="col-sm-9">
                                                    <input type="date" class="form-control datepicker guardar" id="txtTP_Desde" placeholder="Desde" required>
                                                </div>
                                            </div> 
                                        </div>
                                        <div class="col-sm-5">
                                            <div class="form-group">
                                                <label for="txtTP_Filtro" class="col-sm-3 control-label">Hasta</label>
                                                <div class="col-sm-9">
                                                    <input type="date" class="form-control datepicker guardar" id="txtTP_Hasta" placeholder="Hasta" required>
                                                </div>
                                            </div> 
                                        </div>
                                        <div class="text-right">
                                            <button type="submit" class="btn btn-success btn-lg"> Buscar</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Resultados<small></small></h2>
                        </div>
                        <div class="card-body card-padding form-horizontal">
                            <div id="cntTP_BotonesCircuito" class="row col-sm-12 p-5">
                                <div class="alert alert-info" role="alert"><h1 id="lblTP_CircuitosIdentificados" class="c-white"></h1> </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 table-responsive">
                                    <table id="tblTP_Resultado" class="table table-condensed table-hover table-striped">
                                        <thead>                                    
                                            <tr>
                                                <th></th>
                                                <th><input type="checkbox" id="chkTP_ProgramacionBorrar" class="chkTP_Programacion"></th>
                                                <th></th>
                                                <th>Circuito</th>
                                                <th>Número de Evento o TP</th>
                                                <th>Trafo</th>
                                                <th>Nodo</th>
                                                <th>Fases</th>
                                                <th>KVA</th>
                                                <th>BLA</th>
                                                <th>Programación</th>
                                                <th>Apertura</th>
                                                <th>Cierre</th>
                                                <th>Dirección</th>
                                                <th>Barrio</th>
                                                <th>Encargado</th>
                                                <th>Teléfono</th>
                                                <th>Observaciones</th>
                                                <th>Municipio</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                                <!--
                                <button id="btnNroEvento_Borrar" class="btn btn-danger waves-effect waves-effect col-sm-12 col-md-4 m-10"><i class="zmdi zmdi-delete zmdi-hc-fw"></i> Registrar seleccionados</button>
                                <button id="btnNroEvento_Borrar" class="btn btn-danger waves-effect waves-effect col-sm-12 col-md-4 m-10"><i class="zmdi zmdi-delete zmdi-hc-fw"></i> Reprogramar los seleccionados</button>
                                -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <footer id="footer">
                <!--Copyright &copy; 2015 Material Admin-->

                <ul class="f-menu">
                    <img src="img/logo_gris.png" alt="">
                </ul>
            </footer>

            <div class="modal fade" id="cntTP_EditarRegistro" tabindex="-1" role="dialog" aria-hidden="true">
	            <div class="modal-dialog modal-lg">
	                <div class="modal-content">
	                    <form id="frmTP_EditarRegistro" class="form-horizontal" role="form">
	                        <div class="modal-header">
	                            <h4 class="modal-title">Editar Registro de Programación</h4>
	                        </div>
	                        <div class="modal-body">
	                            <input type="hidden" class="form-control guardar" idEdit="0" id="txtTP_Editar_id" required>
	                            <div class="row">
                                    <div class="alert alert-info" id="lblTP_Editar_id" role="alert"></div>
                                </div>
                                <div class="row">
	                                 <div class="col-md-6">
	                                    <div class="form-group">
	                                        <label for="txtTP_Editar_Ingreso" class="col-sm-4 control-label">Se ingresa Trabajo Programado?</label>
	                                        <div class="col-sm-8">
	                                            <div class="fg-line">
	                                                <select class="form-control guardar" idEdit="3" id="txtTP_Editar_Ingreso" placeholder="Ingreso">
                                                        <option value="">Selecciona una opción</option>
                                                        <option value="Se ingresó">Sí</option>
                                                        <option value="No se ingresó">No</option>
                                                    </select>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
	                                <div class="col-md-6">
                                        <div class="alert alert-danger" id="lblTP_Editar_Observaciones" role="alert">Debes poner la observación de por qué no se ingresó</div>
                                        
	                                    <div class="form-group">
	                                        <label for="txtTP_Editar_obsIngreso" class="col-sm-4 control-label">Observaciones</label>
	                                        <div class="col-sm-8">
	                                            <div class="fg-line">
	                                                <textarea class="form-control guardar" idEdit="4" id="txtTP_Editar_obsIngreso" placeholder="Observaciones"></textarea>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
                                </div>
                                <div class="row">
	                                 <div class="col-md-6">
	                                    <div class="form-group">
	                                        <label for="txtTP_Editar_estadoFinal" class="col-sm-4 control-label">Estado Final</label>
	                                        <div class="col-sm-8">
	                                            <div class="fg-line">
	                                                <select class="form-control guardar" idEdit="3" id="txtTP_Editar_estadoFinal" placeholder="Estado Final">
                                                        <option value="">Selecciona una opción</option>
                                                        <option value="Se Aprobó">Se Aprobó</option>
                                                        <option value="Se Canceló">Se Canceló</option>
                                                        <option value="Se Reprograma">Se Reprograma</option>
                                                    </select>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="txtTP_Editar_Numero_De_Aprobacion" class="col-sm-4 control-label">Numero de Aprobación</label>
                                            <div class="col-sm-8">
                                                <div class="fg-line">
                                                    <input type="text" class="form-control guardar" id="txtTP_Editar_Numero_De_Aprobacion" placeholder="Numero de Aprobación">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
	                                <div class="col-md-6">
	                                    <div class="form-group">
	                                        <label for="txtTP_Editar_Ejecucion" class="col-sm-4 control-label">Ejecución</label>
	                                        <div class="col-sm-8">
	                                            <div class="fg-line">
	                                                <select class="form-control guardar" idEdit="3" id="txtTP_Editar_Ejecucion" placeholder="Estado Final">
                                                        <option value="">Selecciona una opción</option>
                                                        <option value="Se Ejecuta">Se Ejecuta</option>
                                                        <option value="No se Ejecuta">No se Ejecuta</option>
                                                    </select>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
                                     <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="txtTP_Editar_Actividad" class="col-sm-4 control-label">Actividad</label>
                                            <div class="col-sm-8">
                                                <div class="fg-line">
                                                    <select class="form-control guardar" idEdit="3" id="txtTP_Editar_Actividad" placeholder="Actividad">
                                                        <option value="">Selecciona una opción</option>
                                                        <option value="Toma de Muestra">Toma de Muestra</option>
                                                        <option value="Cambio de Transformador">Cambio de Transformador</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="txtTP_Editar_Muestreado" class="col-sm-4 control-label">Muestreado</label>
                                            <div class="col-sm-8">
                                                <div class="fg-line">
                                                    <select class="form-control guardar" idEdit="3" id="txtTP_Editar_Muestreado" placeholder="Muestreado">
                                                        <option value="">Selecciona una opción</option>
                                                        <option value="Si">Si</option>
                                                        <option value="No">No</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="txtTP_Editar_Cambiado" class="col-sm-4 control-label">Cambiado</label>
                                            <div class="col-sm-8">
                                                <div class="fg-line">
                                                    <select class="form-control guardar" idEdit="3" id="txtTP_Editar_Cambiado" placeholder="Muestreado">
                                                        <option value="">Selecciona una opción</option>
                                                        <option value="Si">Si</option>
                                                        <option value="No">No</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                     <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="txtTP_Editar_Encargado_de_la_TP" class="col-sm-4 control-label">Encargado</label>
                                            <div class="col-sm-8">
                                                <div class="fg-line">
                                                    <input type="text" class="form-control guardar" id="txtTP_Editar_Encargado_de_la_TP" placeholder="Encargado">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
	                        </div>
	                        <div class="modal-footer">
	                            <button type="submit" class="btn btn-link">Guardar</button>
	                            <button type="button" class="btn btn-link" data-dismiss="modal">Cancelar</button>
	                        </div>
	                    </form>
	                </div>
	            </div>
	        </div>

        </section>

        <!-- Page Loader -->
        <div class="page-loader palette-Teal bg">
            <div class="preloader pl-xl pls-white">
                <svg class="pl-circular" viewBox="25 25 50 50">
                    <circle class="plc-path" cx="50" cy="50" r="20"/>
                </svg>
            </div>
        </div>
        
        <!-- Javascript Libraries -->
        <script src="vendors/bower_components/jquery/dist/jquery.min.js"></script>
        <script src="vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        
        <script src="vendors/bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
        <script src="vendors/bower_components/Waves/dist/waves.min.js"></script>
        <script src="vendors/bootstrap-growl/bootstrap-growl.min.js"></script>
        <script src="vendors/bootgrid/jquery.bootgrid.updated.min.js"></script>
        <script src="vendors/bower_components/autosize/dist/autosize.min.js"></script>
        <script src="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.min.js"></script>

        <script src="vendors/bower_components/moment/min/moment.min.js"></script>
        <script src="vendors/bower_components/moment/min/local.es.js"></script>
        <script src="vendors/bower_components/bootstrap-select/dist/js/bootstrap-select.js"></script>
        <script src="vendors/bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
        <script src="vendors/bower_components/select2/select2.js"></script>
        <script src="vendors/bower_components/select2/i18n/es.js"></script>
        <script src="vendors/input-mask/input-mask.min.js"></script>

        <script src="vendors/bower_components/typeahead.js/dist/typeahead.bundle.min.js"></script>

        <script src="vendors/datatables2/dataTables.js"></script>
        <script src="vendors/datatables2/Buttons-1.2.4/js/dataTables.buttons.js"></script>
        <script src="vendors/datatables2/Buttons-1.2.4/js/buttons.bootstrap.js"></script>
        <script src="vendors/datatables2/Buttons-1.2.4/js/jszip.min.js"></script>

        <script src="vendors/bower_components/jquery-placeholder/jquery.placeholder.min.js"></script>
        

        <script src="js/functions.js"></script>
        <script src="js/actions.js"></script>

        <script src="customJS/funciones.js"></script>
        <script src="customJS/aquiles.js"></script>
        <script>
            function iniciarModulo()
            {
                $("#lblHeader_NomModulo").text("Trabajos Programados");

                var tHoy = obtenerFecha().substring(0, 10);
                $("#txtTP_Desde").val(tHoy);
                $("#txtTP_Hasta").val(tHoy);

                $("#frmTP_Busqueda").on("submit", function(evento)
                {
                    evento.preventDefault();

                    var parametros = {
                        Usuario : Usuario.id,
                        Desde : $("#txtTP_Desde").val(),
                        Hasta : $("#txtTP_Hasta").val()
                    };

                    $("#tblTP_Resultado thead tr").remove();
                    $.post('server/php/proyecto/tp/cargarTP.php', parametros, function(data, textStatus, xhr) 
                    {
                        var tds = '';
                        if (data != 0)
                        {
                            tds += '<tr>';
                            tds += '<th></th>';
                            $.each(data[0], function(index, val) 
                            {
                                tds += '<th>' + index.replace(/_/gi, ' ') + '</td>';
                            });
                            tds += '</tr>';

                            $("#tblTP_Resultado thead").append(tds);

                            tds = '';

                            $.each(data, function(idx, fila) 
                            {
                                tds += '<tr>';
                                tds += '<td><button class="btn palette-Light-Blue btn-icon bg waves-effect waves-circle waves-float btnTP_VerProgramacion"  idProgramacion="' + fila.id + '"><i class="zmdi zmdi-apps"></i></button></td>';
                                $.each(fila, function(index, val) 
                                {
                                    tds += '<td>' + val + '</td>';
                                });
                                tds += '</tr>';
                            });
                        } else
                        {
                            Mensaje("Error", "No hay Trabajos programados en ese rango de fechas", "Error");
                        }

                        $("#tblTP_Resultado").crearDataTable(tds);
                        
                    }, 'json');
                });

                $(document).delegate('.btnTP_VerProgramacion', 'click', function(event) 
                {
                    var fila = $(this).parent('td').parent('tr').find('td');

                    var parametros = {};
                    parametros.id = $(this).attr("idProgramacion");
                    parametros.Estado = $(fila[2]).text();
                    parametros.Ingreso = $(fila[26]).text();
                    parametros.obsIngreso = $(fila[27]).text();
                    parametros.estadoFinal = $(fila[28]).text();
                    parametros.Ejecucion = $(fila[29]).text();

                    parametros.Actividad = $(fila[30]).text();
                    parametros.Muestreado = $(fila[31]).text();
                    parametros.Cambiado = $(fila[32]).text();
                    parametros.Encargado_de_la_TP = $(fila[33]).text();
                    parametros.Numero_De_Aprobacion = $(fila[34]).text();

                    $("#lblTP_Editar_id").html(parametros.id + ': <strong>' + $(fila[4]).text()+ '</strong>');
                    $.each(parametros, function(index, val) 
                    {
                        $('#txtTP_Editar_' + index).val(val);
                    });

                    $('#lblTP_Editar_Observaciones').hide();

                    $('#cntTP_EditarRegistro').modal('show');

                });

                $("#frmTP_EditarRegistro").on('submit', function(evento)
                {
                    evento.preventDefault();

                    $("#frmTP_EditarRegistro").generarDatosEnvio('txtTP_Editar_', function(datos)
                    {
                        datos = JSON.parse(datos);

                        if (datos.Ingreso == 'No se ingresó')
                        {
                            if (datos.obsIngreso == '')
                            {
                                $('#lblTP_Editar_Observaciones').slideDown();
                                $("#txtTP_Editar_obsIngreso").focus();
                                return 0;
                            }
                        }
                        $.post('../server/php/proyecto/tp/registrarTP.php', datos, function(data, textStatus, xhr) {
                            if (data.id == undefined)
                            {

                            } else
                            {
                                var obj = $('.btnTP_VerProgramacion[idProgramacion=' + datos.id + ']');

                                var fila = $(obj).parent('td').parent('tr').find('td');

                                 $(fila[2]).text(data.Estado);
                                 $(fila[26]).text(datos.Ingreso);
                                 $(fila[27]).text(datos.obsIngreso);
                                 $(fila[28]).text(datos.estadoFinal);
                                 $(fila[29]).text(datos.Ejecucion);

                                $(fila[30]).text(datos.Actividad);
                                $(fila[31]).text(datos.Muestreado);
                                $(fila[32]).text(datos.Cambiado);
                                $(fila[33]).text(datos.Encargado_de_la_TP);
                                $(fila[34]).text(datos.Numero_De_Aprobacion);

                                
                                $('#cntTP_EditarRegistro').modal('hide');
                                
                            }
                        }, 'json');                        
                    });
                });
            
            var arrReporto = JSON.parse(localStorage.getItem("wsp_aquiles_reportadores"));

                if (arrReporto == null)
                {   arrReporto = [];    }

                $("#txtTP_Editar_Encargado_de_la_TP").iniciarTypeHead('reportadores', arrReporto);

                $('#txtTP_Editar_Encargado_de_la_TP').bind('typeahead:select', function(ev, suggestion) {
                  $('#txtTP_Editar_Encargado_de_la_TP').attr("placeholder", suggestion);
                });

                $('#txtTP_Editar_Encargado_de_la_TP').on('change', function() 
                {
                    var plholder = $(this).attr("placeholder");
                    var str = $(this).val();

                    if (plholder != str)
                    {
                        var arr = JSON.parse(localStorage.getItem("wsp_aquiles_reportadores"));
                        if (arr == null)
                        {
                            arr = [str];
                        } else
                        {
                            arr.push(str);
                        }

                        localStorage.setItem("wsp_aquiles_reportadores", JSON.stringify(arr));

                        $("#txtTP_Editar_Encargado_de_la_TP").iniciarTypeHead('reportadores', arr);
                    }
                    $('#txtTP_Editar_Encargado_de_la_TP').attr("placeholder", "");
                });
            }

            $.fn.iniciarTypeHead = function(strName, arr)
            {
                if (arr == null || arr == undefined)
                {
                    arr = [];
                }

                vArr = new Bloodhound({
                    datumTokenizer: Bloodhound.tokenizers.whitespace,
                    queryTokenizer: Bloodhound.tokenizers.whitespace,
                    local: arr
                });

                $(this).typeahead({
                    hint: true,
                    highlight: true,
                    minLength: 1
                },
                {
                  name: strName,
                  source: vArr
                });
            }

        </script>
    </body>
  </html>


